# 仓储监控系统 - 编辑模式功能指南

## 📋 概述

编辑模式提供了强大的可视化编辑功能，允许用户自定义传送带布局、设备位置，并进行实时的视图操控。本指南详细介绍所有编辑功能的使用方法。

## 🎛️ 进入编辑模式

### 启用编辑模式
1. 点击右侧控制面板中的 **"编辑布局"** 按钮
2. 界面将切换到编辑模式，显示额外的编辑工具
3. 按钮文字变更为 **"退出编辑"**，点击可返回查看模式

### 编辑模式特征
- ✅ 显示路径节点编辑点
- ✅ 启用设备拖拽功能
- ✅ 显示路径反转按钮
- ✅ 启用视图缩放和平移
- ✅ 显示设备复制/删除控件

## 🔍 视图控制功能

### 画布缩放
| 操作方式 | 说明 | 快捷键/方法 |
|----------|------|-------------|
| **鼠标滚轮** | 在鼠标位置进行缩放 | 向上滚轮：放大<br/>向下滚轮：缩小 |
| **放大按钮** | 以屏幕中心放大 | 点击 🔍 放大 |
| **缩小按钮** | 以屏幕中心缩小 | 点击 🔍 缩小 |

### 画布平移
| 操作方式 | 说明 |
|----------|------|
| **鼠标拖拽** | 在空白区域拖拽可平移整个画布 |
| **键盘方向键** | ↑↓←→ 方向键精确平移画布（每次20像素） |

### 视图重置
| 功能 | 说明 | 按钮 |
|------|------|------|
| **重置缩放** | 恢复到默认缩放级别（1:1） | 📍 重置 |
| **适配屏幕** | 自动调整视图以显示所有内容 | 📐 适配 |

### 缩放范围
- **最小缩放**: 0.2倍（20%）
- **最大缩放**: 3.0倍（300%）
- **缩放步长**: 0.1倍（10%）

### 键盘快捷键
| 快捷键 | 功能 | 说明 |
|--------|------|------|
| **+ / =** | 放大视图 | 以画布中心为焦点放大 |
| **- / _** | 缩小视图 | 以画布中心为焦点缩小 |
| **Ctrl+0** | 重置缩放 | 恢复到1:1比例 |
| **Ctrl+F** | 适配屏幕 | 自动调整视图显示所有内容 |
| **↑ ↓ ← →** | 平移画布 | 每次移动20像素 |
| **Esc** | 退出编辑 | 返回查看模式 |

> **注意**: 键盘快捷键仅在编辑模式下生效，且不会影响输入框内的正常输入。

## 🔄 分拣线管理功能

### 分拣线控制操作
1. **进入编辑模式**：启用编辑模式后，每条传送带路径中心会显示控制按钮组
2. **识别控制按钮**：
   - **反转按钮**：蓝色圆形背景，中心有 **⟲** 图标
   - **删除按钮**：红色圆形背景，中心有 **×** 图标
   - **方向切换按钮**：紫色圆形背景，中心有 **↔️/↕️** 图标
3. **路径名称**：按钮下方显示路径名称

### 反转功能
- **路径点顺序反转**：起点和终点互换
- **包裹流向改变**：包裹将沿反转后的方向移动
- **设备关联更新**：相机和摆轮的触发逻辑自动适应新方向
- **自动保存**：反转操作会自动保存到本地存储

### 删除功能
- **路径删除**：点击红色删除按钮删除整条分拣线
- **设备清理**：自动删除路径上的所有关联设备
- **确认对话框**：删除前会弹出确认对话框防止误操作
- **系统保护**：无法删除系统关键路径（layout_开头的路径）

### 方向切换功能
- **双向切换**：支持垂直↔水平方向切换
- **智能重排**：切换方向时自动重新排列路径点
- **保持中心**：以路径中心为基准进行方向变换
- **设备跟随**：传送带方向切换时，上面的相机和摆轮自动跟随调整方向
- **智能检测**：自动识别路径上的所有设备（50像素容差范围）
- **即时生效**：方向切换立即反映在传送带和设备的视觉效果上

### 新增功能
- **编辑工具栏**：提供"新增传送带"按钮
- **默认配置**：新建路径为垂直方向，包含3个控制点
- **智能定位**：新路径创建在当前视图中心
- **自动命名**：系统自动分配路径ID（custom_path_1、custom_path_2等）

### 支持的路径类型
| 路径类型 | 路径ID | 说明 |
|----------|--------|------|
| **扫码复核线1** | `scan_line_1_start` | 垂直路径，可反转方向 |
| **扫码复核线2** | `scan_line_2_start` | 垂直路径，可反转方向 |
| **SKU分拣线1** | `sku_line_1` | 垂直路径，包含6个摆轮 |
| **SKU分拣线2** | `sku_line_2` | 垂直路径，包含6个摆轮 |
| **大区分拣线** | `region_sort_line` | 水平路径，包含6个摆轮 |

## 📍 节点编辑功能

### 路径节点操作
- **可见性**：编辑模式下显示为橙色圆点
- **拖拽移动**：点击节点并拖拽可调整路径形状
- **约束规则**：端点只能沿路径方向移动，中间点可自由移动

### 节点类型
| 节点类型 | 特征 | 移动约束 |
|----------|------|----------|
| **起点** | 路径第一个点 | 垂直路径：仅Y轴<br/>水平路径：仅X轴 |
| **中间点** | 路径中间点 | 无约束，自由移动 |
| **终点** | 路径最后一个点 | 垂直路径：仅Y轴<br/>水平路径：仅X轴 |

## 🎯 设备编辑功能

### 相机设备
- **拖拽移动**：在编辑模式下可拖拽到任意位置
- **视觉反馈**：离线设备显示为灰色，50%透明度
- **方向切换**：点击方向按钮（↔️/↕️）切换水平/垂直方向
- **复制功能**：点击 **+** 按钮复制设备
- **删除功能**：点击 **×** 按钮删除设备

### 摆轮设备
- **拖拽移动**：可拖拽到传送带上的任意位置
- **复制功能**：点击 **+** 按钮复制设备
- **删除功能**：点击 **×** 按钮删除设备
- **方向切换**：点击方向按钮（↔️/↕️）切换水平/垂直方向
- **旋转响应**：根据分拣方向自动旋转摆轮角度

### 设备新增功能
- **编辑工具栏**：编辑模式下显示专用工具栏
- **点击放置模式**：选择设备类型后点击画布放置
- **快速添加模式**：一键在屏幕中心添加设备
- **自动ID分配**：系统自动分配唯一设备ID

### 设备方向切换功能

#### 摆轮方向切换
| 方向 | 显示形态 | 适用场景 |
|------|----------|----------|
| **垂直方向** | 摆轮垂直排列，基座竖立 | 适用于垂直传送带或紧凑空间 |
| **水平方向** | 摆轮水平排列，基座卧放 | 适用于水平传送带或宽敞区域 |

#### 相机方向切换
| 方向 | 显示形态 | 适用场景 |
|------|----------|----------|
| **垂直方向** | 龙门架垂直布局，相机悬挂在顶部 | 适用于垂直传送带监控 |
| **水平方向** | 龙门架水平布局，相机侧向安装 | 适用于水平传送带监控 |

### 设备方向切换操作
1. **进入编辑模式**：启用编辑模式后可以编辑设备
2. **识别方向按钮**：设备上方中央显示方向切换按钮
   - **↔️**：当前为垂直方向，点击切换为水平
   - **↕️**：当前为水平方向，点击切换为垂直
3. **即时切换**：点击按钮后立即更新设备方向和显示形态
4. **自动保存**：方向切换后自动保存到布局配置

### 设备状态指示
| 状态 | 视觉效果 | 说明 |
|------|----------|------|
| **在线** | 正常颜色，100%不透明度 | 设备正常运行 |
| **离线** | 灰色，50%透明度 | 设备断线或故障 |
| **扫描中** | 绿色闪烁，放大动画 | 相机正在扫描包裹 |
| **分拣中** | 红色边框，旋转动画 | 摆轮正在执行分拣 |

## 💾 数据持久化

### 自动保存
- **节点移动**：拖拽节点后自动保存
- **设备移动**：拖拽设备后自动保存
- **路径反转**：执行反转后自动保存
- **设备复制/删除**：操作后自动保存
- **设备新增**：添加新设备后自动保存
- **路径新增/删除**：路径操作后自动保存

### 手动保存
- **保存按钮**：点击 **💾 保存布局** 按钮手动保存
- **存储位置**：浏览器本地存储（localStorage）
- **存储内容**：路径坐标、设备位置、布局配置

### 重置功能
- **重置按钮**：点击 **🔄 重置布局** 按钮
- **确认对话框**：操作前会弹出确认对话框
- **恢复默认**：重置到初始布局状态

## 🛠️ 编辑工具栏使用指南

### 工具栏位置
- **显示条件**：仅在编辑模式下显示
- **位置**：画布左上角的浮动面板
- **主题适配**：自动适配白天/夜间主题

### 新增设备操作
1. **点击放置模式**：
   - 点击"新增相机"或"新增摆轮"按钮
   - 鼠标光标变为十字形
   - 工具栏显示放置提示
   - 点击画布任意位置放置设备
   - 点击"取消"或ESC键退出放置模式

2. **快速添加模式**：
   - 点击"快速添加相机"或"快速添加摆轮"
   - 设备自动添加到屏幕中心
   - 可直接拖拽到目标位置

### 新增分拣线操作
- 点击"新增传送带"按钮
- 系统在视图中心创建默认垂直路径
- 包含3个控制点，可立即编辑调整
- 自动分配唯一路径ID

### 工具栏状态提示
- **放置模式**：显示蓝色提示条
- **设备类型**：明确显示当前放置的设备类型
- **取消操作**：提供取消按钮快速退出

### 设备智能跟随功能
- **自动检测**：系统自动检测距离传送带50像素范围内的设备
- **同步切换**：传送带方向改变时，上面的设备方向自动跟随
- **批量更新**：一次传送带操作可同时更新多个设备
- **详细反馈**：控制台显示每个设备的方向变化详情

## 🚀 高级使用技巧

### 精确编辑
1. **放大视图**：对需要精确编辑的区域进行放大
2. **使用网格**：利用设备对齐作为参考网格
3. **分段编辑**：分别调整路径的不同段落
4. **批量创建**：使用工具栏快速创建多个设备

### 批量操作
1. **设备复制**：先复制设备，再拖拽到目标位置
2. **路径规划**：先设计主干路径，再添加分支
3. **分区编辑**：按功能区域分别进行编辑
4. **模板创建**：创建自定义路径作为模板
5. **批量方向调整**：切换传送带方向时自动更新所有相关设备

### 性能优化
1. **编辑完成后退出编辑模式**：减少界面元素，提高渲染性能
2. **合理使用缩放**：避免过度放大导致的操作卡顿
3. **定期保存**：重要修改后手动保存确保数据安全
4. **批量删除**：删除路径时自动清理关联设备

## 🔧 故障排除

### 常见问题

**1. 无法拖拽设备**
- 确认已进入编辑模式
- 检查设备是否被其他元素遮挡
- 尝试点击设备中心区域

**2. 缩放功能无响应**
- 确认鼠标在画布区域内
- 检查浏览器是否支持滚轮事件
- 尝试使用缩放按钮替代

**3. 路径反转后包裹异常**
- 反转操作会影响正在运行的包裹
- 建议在系统空闲时进行路径调整
- 如有异常可重置布局

**4. 编辑内容丢失**
- 检查浏览器是否清除了本地存储
- 使用手动保存功能确保数据持久化
- 重要布局建议导出备份（未来版本支持）

### 性能建议
- **推荐浏览器**：Chrome 90+, Firefox 88+, Safari 14+
- **推荐分辨率**：1920×1080或更高
- **内存要求**：建议8GB以上系统内存

## 📱 移动端支持

### 触摸操作
| 手势 | 功能 | 说明 |
|------|------|------|
| **单指拖拽** | 移动对象 | 拖拽设备或节点 |
| **双指捏合** | 缩放视图 | 放大或缩小画布 |
| **双指拖拽** | 平移视图 | 移动整个画布 |
| **单击** | 选择/操作 | 点击按钮或选择对象 |

### 移动端限制
- **编辑精度**：触摸精度低于鼠标操作
- **快捷键**：不支持键盘快捷键
- **多任务**：建议关闭其他应用以确保性能

## 🔧 设备方向和位置跟随逻辑 - 重要修复

### v2.3.3 修复内容 (2024-01-XX)

#### 🐛 修复问题
- **摆轮方向错误**：默认布局下摆轮与传送带平行，应该垂直
- **相机位置跟随错误**：传送带方向切换时相机位置计算不正确

#### 🔍 问题根因

**1. 摆轮方向逻辑错误**
```javascript
// ❌ 错误逻辑：摆轮与传送带平行
device.orientation = newDirection;

// ✅ 正确逻辑：摆轮与传送带垂直
if (device.type === 'sorter') {
  device.orientation = newDirection === 'vertical' ? 'horizontal' : 'vertical';
}
```

**2. 相机位置强制重置**
```javascript
// ❌ 错误逻辑：强制重新定位相机
if (device.type === 'camera') {
  if (newDirection === 'vertical') {
    newX = pathCenter.x + Math.abs(crossOffset) + 30;
  } else {
    newY = pathCenter.y - Math.abs(crossOffset) - 30;
  }
}

// ✅ 正确逻辑：保持相对位置关系
// 相机应该跟随传送带移动，但保持相对距离
```

#### ✅ 解决方案

**1. 修复摆轮方向逻辑**
- 摆轮方向始终与传送带垂直
- 垂直传送带 → 水平摆轮
- 水平传送带 → 垂直摆轮

**2. 修复相机位置跟随**
- 移除强制重新定位的逻辑
- 保持相机与传送带的相对位置关系
- 使用坐标转换算法保持相对距离

**3. 统一默认方向设置**
- 加载布局时：摆轮默认水平，相机默认垂直
- 新建设备时：摆轮默认水平，相机默认垂直
- 复制设备时：保持原设备的方向属性

#### 🔧 核心修改

**1. 设备方向更新逻辑**
```javascript
// updateDevicesForPathDirectionChangeWithDeviceList 函数
if (device.type === 'sorter') {
  // 🔧 摆轮应该与传送带垂直
  device.orientation = newDirection === 'vertical' ? 'horizontal' : 'vertical';
} else if (device.type === 'camera') {
  // 相机的方向跟随传送带方向
  device.orientation = newDirection;
}
```

**2. 默认方向设置统一**
```javascript
// loadLayout, addNewDevice, applyLayoutUpdate 函数中
if (device.type === 'sorter') {
  // 摆轮默认应该与传送带垂直（传送带默认是垂直的，所以摆轮应该是水平的）
  device.orientation = 'horizontal';
} else {
  // 相机默认跟随传送带方向
  device.orientation = 'vertical';
}
```

**3. 相机位置计算修复**
```javascript
// findBestPositionOnNewPath 函数中
// 🔧 修复相机位置：保持原有的相对位置关系，不强制重新定位
// 相机应该跟随传送带移动，但保持相对距离
```

#### 🎯 功能效果

**摆轮行为**：
- ✅ 默认布局：摆轮水平放置（与垂直传送带垂直）
- ✅ 方向切换：摆轮始终与传送带保持垂直关系
- ✅ 新建摆轮：默认水平方向
- ✅ 复制摆轮：保持原设备方向

**相机行为**：
- ✅ 默认布局：相机垂直放置（与垂直传送带平行）
- ✅ 方向切换：相机跟随传送带方向，保持扫描姿态
- ✅ 位置跟随：保持与传送带的相对位置关系
- ✅ 新建相机：默认垂直方向

#### 🧪 测试验证

**摆轮方向测试**：
1. 重置布局 → 摆轮应该是水平的
2. 切换传送带为水平 → 摆轮应该变为垂直
3. 再切换传送带为垂直 → 摆轮应该变为水平
4. 新建摆轮 → 默认水平方向

**相机跟随测试**：
1. 在垂直传送带上放置相机
2. 切换传送带为水平 → 相机应该跟随移动并保持相对位置
3. 再次切换 → 相机应该回到相应位置
4. 多次切换验证位置稳定性

#### 📊 技术细节

**设备方向关系表**：
| 传送带方向 | 摆轮方向 | 相机方向 |
|------------|----------|----------|
| vertical   | horizontal | vertical |
| horizontal | vertical | horizontal |

**坐标转换算法**：
- 原始相对偏移 = 设备位置 - 路径中心
- 沿路径方向偏移 ↔ 垂直路径方向偏移
- 新位置 = 新路径中心 + 转换后偏移

---

**修复完成时间**：2024-01-XX  
**修复版本**：v2.3.3  
**影响功能**：设备方向设置、设备智能跟随、默认布局  
**测试状态**：✅ 已验证

---

💡 **提示**: 编辑功能强大但需谨慎使用，建议在理解业务流程的基础上进行布局调整，避免影响实际生产操作。

## 🔧 根据传送带方向智能设置设备默认方向 - 关键修复

### v2.3.4 修复内容 (2024-01-XX)

#### 🐛 修复问题
- **设备默认方向错误**：之前假设所有传送带都是垂直的，但默认布局中有水平传送带
- **region区域设备方向错误**：水平传送带上的设备（region-camera-1, region-sorter等）方向设置不正确

#### 🔍 问题根因

**默认布局分析**：
- **垂直传送带**：`scan_line_1_start`, `scan_line_2_start`, `sku_line_1`, `sku_line_2`
- **水平传送带**：`region_sort_line`

**错误逻辑**：
```javascript
// ❌ 错误假设：所有设备都在垂直传送带上
if (device.type === 'sorter') {
  device.orientation = 'horizontal'; // 固定设置为水平
}
```

**正确逻辑**：
```javascript
// ✅ 根据设备所在传送带的实际方向设置
const devicePathDirection = getDevicePathDirection(device);
if (device.type === 'sorter') {
  device.orientation = devicePathDirection === 'vertical' ? 'horizontal' : 'vertical';
}
```

#### ✅ 解决方案

**1. 创建设备路径方向检测函数**
```javascript
function getDevicePathDirection(device) {
  // 遍历所有路径，找到设备所在的路径
  for (const [pathKey, pathObj] of Object.entries(paths)) {
    if (pathObj.points && pathObj.points.length >= 2) {
      if (isDeviceOnPath(device, pathKey)) {
        return pathObj.direction; // 返回实际传送带方向
      }
    }
  }
  
  // 如果没有找到设备所在的路径，使用ID判断
  if (device.id.includes('region')) {
    return 'horizontal'; // region设备在水平传送带上
  }
  
  return 'vertical'; // 默认垂直方向
}
```

**2. 统一设备默认方向设置逻辑**
在所有相关函数中应用智能检测：
- `loadLayout()` - 加载布局时
- `addNewDevice()` - 新建设备时  
- `applyLayoutUpdate()` - 云端同步时

**3. 设备方向映射规则**
| 传送带方向 | 摆轮方向 | 相机方向 | 示例设备 |
|------------|----------|----------|----------|
| vertical   | horizontal | vertical | camera-1, sorter-1, sku-* |
| horizontal | vertical | horizontal | region-camera-1, region-sorter-* |

#### 🔧 核心修改

**1. 设备方向检测算法**
```javascript
// getDevicePathDirection 函数
// 1. 几何检测：检查设备是否在某个路径上
// 2. ID模式匹配：region设备识别为水平传送带
// 3. 默认回退：未匹配设备默认为垂直传送带
```

**2. 智能默认方向设置**
```javascript
const devicePathDirection = getDevicePathDirection(device);
if (device.type === 'sorter') {
  // 摆轮应该与传送带垂直
  device.orientation = devicePathDirection === 'vertical' ? 'horizontal' : 'vertical';
} else {
  // 相机跟随传送带方向
  device.orientation = devicePathDirection;
}
```

**3. 详细调试日志**
```javascript
console.log(`🔍 设备 ${device.id} 检测到所在路径 ${pathKey}，方向: ${pathObj.direction}`);
console.log(`🔍 设备 ${device.id} 基于ID识别为水平传送带设备`);
console.log(`🔍 设备 ${device.id} 使用默认垂直方向`);
```

#### 🎯 功能效果

**垂直传送带设备**（scan_line, sku_line）：
- ✅ 摆轮：水平方向（与传送带垂直）
- ✅ 相机：垂直方向（与传送带平行）

**水平传送带设备**（region_sort_line）：
- ✅ 摆轮：垂直方向（与传送带垂直）
- ✅ 相机：水平方向（与传送带平行）

#### 🧪 测试验证

**默认布局测试**：
1. **重置布局** → 检查所有设备方向是否正确
2. **垂直传送带设备** → camera-1, sorter-1应该是vertical, horizontal
3. **水平传送带设备** → region-camera-1, region-sorter-*应该是horizontal, vertical
4. **新建设备测试** → 在不同传送带上新建设备，验证默认方向

**方向切换测试**：
1. **垂直→水平切换** → 设备方向应该相应调整
2. **水平→垂直切换** → 设备方向应该相应调整
3. **跨区域移动** → 设备从一个传送带移到另一个传送带

#### 📊 设备分布映射

**垂直传送带区域**：
```
scan_line_1_start: camera-1, sorter-1
scan_line_2_start: camera-2, sorter-2  
sku_line_1: sku-camera-1, sku-sorter-1-*
sku_line_2: sku-camera-2, sku-sorter-2-*
```

**水平传送带区域**：
```
region_sort_line: region-camera-1, region-sorter-*
```

#### 📈 技术优势

**1. 智能检测**：
- 几何位置检测优先级最高
- ID模式匹配作为后备方案
- 默认回退确保系统稳定性

**2. 性能优化**：
- 复用现有的`isDeviceOnPath`函数
- 只在需要时进行路径遍历
- 缓存友好的检测算法

**3. 扩展性**：
- 支持动态添加新传送带
- 支持复杂的传送带布局
- 易于添加新的设备类型

---

**修复完成时间**：2024-01-XX  
**修复版本**：v2.3.4  
**影响功能**：设备默认方向设置、布局兼容性、region区域设备  
**测试状态**：✅ 已验证 

## 🏷️ 传送带自定义名称功能

### v2.3.5 新增功能 (2024-01-XX)

#### ✨ 功能概述
- **自定义名称**：为每条传送带设置有意义的名称，替代技术性的路径ID
- **名称编辑**：在编辑模式下可视化编辑传送带名称
- **API支持**：支持通过传送带名称触发包裹动画，提高WebSocket集成的易用性
- **向后兼容**：自动为现有传送带添加默认名称

#### 🎯 使用场景
- **WebSocket集成**：后端可以通过传送带名称而非技术ID触发包裹动画
- **用户界面**：编辑模式下显示直观的传送带名称
- **系统维护**：运维人员可以快速识别传送带功能和用途
- **团队协作**：统一的命名规范提高沟通效率

#### 🔧 功能实现

**1. 默认传送带名称映射**
```javascript
// PathManager.js 中的默认名称配置
scan_line_1_start: { 
  name: '扫码线1',
  direction: 'vertical', 
  points: [...]
}
```

**2. 名称编辑界面**
- 📝 编辑按钮：在传送带中心区域显示铅笔图标
- 💬 弹窗输入：点击后弹出名称编辑对话框
- ✅ 实时保存：修改后自动保存到本地存储和云端

**3. API接口**
```javascript
// 通过名称查找传送带
const pathResult = findPathByName('扫码线1');

// 通过名称触发包裹动画
triggerPackageByPathName('扫码线1', packageInfo);

// 获取所有传送带名称列表
const pathNames = getAllPathNames();
```

#### 🎨 用户界面

**编辑模式下的传送带控制区域**：
```
    ⟲        ×        ↔️
(反转)   (删除)   (方向切换)

      ✏️
  (名称编辑)

   扫码线1
  (传送带名称)
```

**名称编辑流程**：
1. 进入编辑模式
2. 点击传送带中心的铅笔图标 ✏️
3. 在弹出对话框中输入新名称
4. 确认后自动保存并更新显示

#### 📊 默认名称配置

| 路径ID | 默认名称 | 功能描述 |
|--------|----------|----------|
| scan_line_1_start | 扫码线1 | 左侧扫码复核区第一条线 |
| scan_line_2_start | 扫码线2 | 左侧扫码复核区第二条线 |
| sku_line_1 | SKU主线1 | 中央SKU分拣第一条主线 |
| sku_line_2 | SKU主线2 | 中央SKU分拣第二条主线 |
| region_sort_line | 大区分拣线 | 右侧水平大区分拣线 |

#### 🔌 WebSocket集成示例

**后端触发包裹动画**：
```javascript
// 旧方式：使用技术性路径ID
websocket.send({
  type: 'trigger-package',
  pathId: 'scan_line_1_start',
  packageInfo: {...}
});

// 新方式：使用直观的传送带名称
websocket.send({
  type: 'trigger-package-by-name',
  pathName: '扫码线1',
  packageInfo: {...}
});
```

**前端处理逻辑**：
```javascript
// WebSocket消息处理
if (data.type === 'trigger-package-by-name') {
  const success = triggerPackageByPathName(data.pathName, data.packageInfo);
  if (!success) {
    console.error(`找不到传送带: ${data.pathName}`);
  }
}
```

#### 🛡️ 向后兼容处理

**自动名称分配**：
- 加载布局时自动检测缺失的名称
- 根据路径ID自动分配合适的默认名称
- 新建传送带自动生成递增名称（传送带1, 传送带2...）

**兼容性函数**：
```javascript
// loadLayout(), applyLayoutUpdate() 中的兼容性处理
if (!pathObj.name) {
  if (key.includes('scan_line_1')) pathObj.name = '扫码线1';
  else if (key.includes('scan_line_2')) pathObj.name = '扫码线2';
  // ... 其他默认名称映射
  else pathObj.name = key; // 后备方案
}
```

#### 🎯 技术优势

**1. 用户体验**：
- 直观的名称显示，无需记忆技术ID
- 可视化编辑界面，操作简单直接
- 实时保存，避免数据丢失

**2. 开发效率**：
- WebSocket集成更简单，使用名称而非ID
- API接口友好，提高开发体验
- 统一的命名规范，减少沟通成本

**3. 系统维护**：
- 传送带功能一目了然
- 便于故障排查和性能监控
- 支持系统扩展和重构

#### 🧪 测试用例

**名称编辑测试**：
1. **进入编辑模式** → 应显示名称编辑按钮
2. **点击编辑按钮** → 应弹出输入对话框，显示当前名称
3. **输入新名称** → 应实时更新显示，保存到存储
4. **取消编辑** → 应保持原名称不变
5. **空名称测试** → 应拒绝空白名称

**API功能测试**：
1. **名称查找** → `findPathByName('扫码线1')` 应返回正确路径
2. **触发动画** → `triggerPackageByPathName('扫码线1', {...})` 应成功创建包裹
3. **名称列表** → `getAllPathNames()` 应返回所有传送带信息
4. **错误处理** → 查找不存在的名称应返回null并记录错误

**向后兼容测试**：
1. **旧布局加载** → 没有名称的传送带应自动获得默认名称
2. **云端同步** → 从云端同步的旧数据应正确添加名称
3. **混合数据** → 部分有名称、部分无名称的数据应正确处理

---

**功能发布时间**：2024-01-XX  
**发布版本**：v2.3.5  
**影响组件**：传送带管理、WebSocket集成、编辑界面  
**测试状态**：✅ 已验证 